### 概述

本设计前提上下文:

- 登录、注册服务作为一个整体存在一个服务中（没有再细分成两个微服务），即两者作为一个单体应用
- 登录、注册服务直接面向nginx层
- 采用RESTful实现接口协议

### 问题分析

- 系统需要应对大流量下的并发，所以采取集群方式部署多个服务实例，解决高可用问题
- 登录后需要存储一些用户状态信息（如token），在集群模式部署条件下，为了考虑系统的横向伸缩性，用户状态信息必须能被公共访问，这里采用redis缓存用户的状态信息
- 使用redis后，系统高可用时，redis必须高可用，所以redis可以通过sentinal 或者 cluster模式部署
- 通过nginx进行负载均衡，将请求分配到多个服务实例，这里也需要部署多个nginx实列，保证高可用。为域名设置多个IP,通过DNS轮询分发请求。
- 数据存储可以使用mysql、或者pg进行存储，按需选择，MS架构，还是集群架构


### 登录、注册方案

#### 注册

- 手机号、邮箱两者间取一个为主，这里取邮箱（必填）
- 邮箱验证（看需求）
- 登录密码（必填）

以上信息是用户第一轮注册，第一轮注册服务端的代码逻辑点：

- 验证邮箱格式，是否已经存在
- 配合验证码测试邮箱真实性，服务端生成验证码，发送到客户邮箱，并缓存验证码信息（缓存进redis）
- 密码验证格式
- 正式提交邮箱，密码进行用户新增，并返回系统自动分配的信息（如用户名）以及其它必要信息（token等）码，同时将信息进行（redis缓存），考虑下列问题：

  由于网络、或者其它原因，客户也许会多次点击提交信息，在APP端没做处理的情况下，通过redis来解决：

  邮箱加上其它信息，生成key，通过 GETSET 来判断用户是否是第一次请求，来决定是否进行后续处理


第二轮，基于第一轮，让用户自动按需填写某些信息：

- 用户名、性别等等
- 保存更新用户信息，同步更新，redis缓存

#### 登录

- 通过邮箱查询对应信息，不存在则返回不存在提示
- 比较密码，密码不正确，返回提示
- 生成必须信息（如token），缓存进redis并返回
